(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}})();var _=(e=>(e.Functional="Functional",e.TextOnly="TextOnly",e.Maintenance="Maintenance",e.Playground="Playground",e.DirectPlayback="DirectPlayback",e))(_||{}),x=(e=>(e.Embed="embed",e.Query="query",e.Partial="partial",e.Answer="answer",e.Complete="done",e))(x||{}),j=(e=>(e.Clip="clip",e.Talk="talk",e))(j||{}),N=(e=>(e.Start="START",e.Stop="STOP",e))(N||{}),ae=(e=>(e.ChatAnswer="chat/answer",e.ChatPartial="chat/partial",e.StreamDone="stream/done",e.StreamStarted="stream/started",e.StreamFailed="stream/error",e.StreamReady="stream/ready",e.StreamCreated="stream/created",e.StreamVideoCreated="stream-video/started",e.StreamVideoDone="stream-video/done",e.StreamVideoError="stream-video/error",e.StreamVideoRejected="stream-video/rejected",e))(ae||{}),b=(e=>(e.New="new",e.Fail="fail",e.Connected="connected",e.Connecting="connecting",e.Closed="closed",e.Completed="completed",e.Disconnected="disconnected",e))(b||{});const G="https://api.d-id.com",ve="wss://notifications.d-id.com",fe="79f81a83a67430be2bc0fd61042b8faa",W=()=>Math.random().toString(16).slice(2);function le(){let e=window.localStorage.getItem("did_external_key_id");return e||(e=Math.random().toString(16).slice(2),window.localStorage.setItem("did_external_key_id",e)),e}let ye=W();function de(e){if(e.type==="bearer")return`Bearer ${e.token}`;if(e.type==="basic")return`Basic ${btoa(`${e.username}:${e.password}`)}`;if(e.type==="key")return`Client-Key ${e.clientKey}.${le()}_${ye}`;throw new Error(`Unknown auth type: ${e}`)}function re(e,t=G,s){const o=async(a,r)=>{const i=await fetch(t+(a!=null&&a.startsWith("/")?a:`/${a}`),{...r,headers:{...r==null?void 0:r.headers,Authorization:de(e),"Content-Type":"application/json"}});if(!i.ok){let n=await i.text().catch(()=>"Failed to fetch");throw s&&s(new Error(n),{url:a,options:r,headers:i.headers}),new Error(n)}return i.json()};return{get(a,r){return o(a,{...r,method:"GET"})},post(a,r,i){return o(a,{...i,body:JSON.stringify(r),method:"POST"})},delete(a,r,i){return o(a,{...i,body:JSON.stringify(r),method:"DELETE"})},patch(a,r,i){return o(a,{...i,body:JSON.stringify(r),method:"PATCH"})}}}function be(e,t=G,s){const o=re(e,`${t}/agents`,s);return{create(a,r){return o.post("/",a,r)},getAgents(a,r){return o.get(`/${a?`?tag=${a}`:""}`,r).then(i=>i??[])},getById(a,r){return o.get(`/${a}`,r)},delete(a,r){return o.delete(`/${a}`,void 0,r)},update(a,r,i){return o.patch(`/${a}`,r,i)},newChat(a,r,i){return o.post(`/${a}/chat`,r,i)},chat(a,r,i,n){return o.post(`/${a}/chat/${r}`,i,n)},createRating(a,r,i,n){return o.post(`/${a}/chat/${r}/ratings`,i,n)},updateRating(a,r,i,n,d){return o.patch(`/${a}/chat/${r}/ratings/${i}`,n,d)},deleteRating(a,r,i,n){return o.delete(`/${a}/chat/${r}/ratings/${i}`,n)}}}const Se=e=>new Promise(t=>setTimeout(t,e));function ke(e){return new Promise((t,s)=>{const{callbacks:o,host:a,auth:r}=e,{onMessage:i=null,onOpen:n=null,onClose:d=null,onError:v=null}=o||{},f=new WebSocket(`${a}?authorization=${de(r)}`);f.onmessage=i,f.onclose=d,f.onerror=m=>{console.error(m),v==null||v("Websocket failed to connect",m),s(m)},f.onopen=m=>{n==null||n(m),t(f)}})}async function Me(e){const{retries:t=1}=e;let s=null;for(let o=0;(s==null?void 0:s.readyState)!==WebSocket.OPEN;o++)try{s=await ke(e)}catch(a){if(o===t)throw a;await Se(o*500)}return s}async function Ce(e,t,s){const o=s!=null&&s.onMessage?[s.onMessage]:[],a=await Me({auth:e,host:t,callbacks:{onError:s==null?void 0:s.onError,onMessage:r=>{const i=JSON.parse(r.data);o.forEach(n=>n(i.event,i))}}});return{socket:a,disconnect:()=>a.close(),subscribeToEvents:r=>o.push(r)}}const _e="X-Playground-Chat";function Ee(e,t,s,o){const a=re(e,`${t}/agents/${s}`,o);return{createStream(r){return a.post("/streams",{compatibility_mode:r.compatibility_mode,stream_warmup:r.stream_warmup,session_timeout:r.session_timeout})},startConnection(r,i,n){return a.post(`/streams/${r}/sdp`,{session_id:n,answer:i})},addIceCandidate(r,i,n){return a.post(`/streams/${r}/ice`,{session_id:n,...i})},sendStreamRequest(r,i,n){return a.post(`/streams/${r}`,{session_id:i,...n})},close(r,i){return a.delete(`/streams/${r}`,{session_id:i})}}}function $e(e,t,s,o){const a=re(e,`${t}/agents/${s}`,o);return{createStream(r,i){return a.post("/streams",{driver_url:r.driver_url,face:r.face,config:r.config,compatibility_mode:r.compatibility_mode,stream_warmup:r.stream_warmup,output_resolution:r.output_resolution,session_timeout:r.session_timeout},i)},startConnection(r,i,n,d){return a.post(`/streams/${r}/sdp`,{session_id:n,answer:i},d)},addIceCandidate(r,i,n,d){return a.post(`/streams/${r}/ice`,{session_id:n,...i},d)},sendStreamRequest(r,i,n,d){return a.post(`/streams/${r}`,{session_id:i,...n},d)},close(r,i,n){return a.delete(`/streams/${r}`,{session_id:i},n)}}}let ue=!1;const I=(e,t)=>ue&&console.log(e,t),Te=(window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection).bind(window);function oe(e){switch(e){case"connected":return b.Connected;case"checking":return b.Connecting;case"failed":return b.Fail;case"new":return b.New;case"closed":return b.Closed;case"disconnected":return b.Disconnected;case"completed":return b.Completed;default:return b.New}}function Oe(){let e=0;return t=>{for(const s of t.values())if(s&&s.type==="inbound-rtp"&&s.kind==="video"){const o=s.bytesReceived,a=o-e>0;return e=o,a}return!1}}function Ie(e,t){const s=Math.max(Math.ceil(10),1);let o=0,a=!1;const r=Oe();return setInterval(async()=>{const i=await e.getStats();r(i)?(o=0,a||(t==null||t(N.Start),a=!0)):a&&(o++,o>=s&&(t==null||t(N.Stop),a=!1))},100)}async function Le(e,t,{debug:s=!1,callbacks:o,auth:a,baseURL:r=G,warmup:i}){ue=s;let n;const{startConnection:d,sendStreamRequest:v,close:f,createStream:m,addIceCandidate:g}=t.videoType===j.Clip?Ee(a,r,e,o.onError):$e(a,r,e,o.onError),{id:h,offer:Z,ice_servers:B,session_id:k}=await m(t),y=new Te({iceServers:B});if(!k)throw new Error("Could not create session_id");const c=Ie(y,o.onVideoStateChange);y.onicecandidate=l=>{I("peerConnection.onicecandidate",l),l.candidate&&l.candidate.sdpMid&&l.candidate.sdpMLineIndex!==null?g(h,{candidate:l.candidate.candidate,sdpMid:l.candidate.sdpMid,sdpMLineIndex:l.candidate.sdpMLineIndex},k):g(h,{candidate:null},k)},y.oniceconnectionstatechange=()=>{var l;I("peerConnection.oniceconnectionstatechange => "+y.iceConnectionState);const w=oe(y.iceConnectionState);w===b.Connected?n=setTimeout(()=>{var p;return(p=o.onConnectionStateChange)==null?void 0:p.call(o,b.Connected)},i?5e3:0):(clearTimeout(n),(l=o.onConnectionStateChange)==null||l.call(o,w))},y.ontrack=l=>{var w;I("peerConnection.ontrack",l),(w=o.onSrcObjectReady)==null||w.call(o,l.streams[0])},await y.setRemoteDescription(Z),I("set remote description OK");const u=await y.createAnswer();return I("create answer OK"),await y.setLocalDescription(u),I("set local description OK"),await d(h,u,k),I("start connection OK"),{speak(l){return v(h,k,l)},async disconnect(){var l,w;if(h){const p=oe(y.iceConnectionState);if(y){if(p===b.New){(l=o.onVideoStateChange)==null||l.call(o,N.Stop),clearInterval(c);return}y.close(),y.oniceconnectionstatechange=null,y.onnegotiationneeded=null,y.onicecandidate=null,y.ontrack=null}try{p===b.Connected&&await f(h,k).catch(M=>{})}catch(M){I("Error on close stream connection",M)}(w=o.onVideoStateChange)==null||w.call(o,N.Stop),clearInterval(c)}},sessionId:k,streamId:h}}let Y={};function De(e){const t=window!=null&&window.hasOwnProperty("DID_AGENTS_API")?"agents-ui":"agents-sdk",s=e.agent.presenter,o={token:e.token||"testKey",distinct_id:e.distinctId||le(),agentId:e.agent.id,agentType:s.type==="clip"&&s.presenter_id.startsWith("v2_")?"clip_v2":s.type,owner_id:e.agent.owner_id??""};return{...o,isEnabled:e.isEnabled??!0,getRandom:()=>Math.random().toString(16).slice(2),track(a,r){if(!this.isEnabled)return Promise.reject("MixPanel analytics is disabled on creation");const{audioPath:i,...n}=r||{},d={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({data:JSON.stringify([{event:a,properties:{...n,...o,source:t,time:Date.now(),$insert_id:this.getRandom(),origin:window.location.href,"Screen Height":window.screen.height||window.innerWidth,"Screen Width":window.screen.width||window.innerHeight,"User Agent":navigator.userAgent}}])})};return fetch("https://api-js.mixpanel.com/track/?verbose=1&ip=1",d).then(v=>v.json()).catch(v=>console.error(v))},linkTrack(a,r,i,n){Y[a]||(Y[a]={events:{},resolvedDependencies:[]}),n.includes(i)||n.push(i);const d=Y[a];if(d.events[i]={props:r},d.resolvedDependencies.push(i),n.every(v=>d.resolvedDependencies.includes(v))){const v=n.reduce((f,m)=>d.events[m]?{...f,...d.events[m].props}:f,{});this.track(a,v),d.resolvedDependencies=d.resolvedDependencies.filter(f=>!n.includes(f)),n.forEach(f=>{delete d.events[f]})}}}}function Pe(e){var t,s,o,a;const r=()=>/Mobi|Android/i.test(navigator.userAgent)?"Mobile":"Desktop",i=()=>{const d=navigator.platform;return d.toLowerCase().includes("win")?"Windows":d.toLowerCase().includes("mac")?"Mac OS X":d.toLowerCase().includes("linux")?"Linux":"Unknown"},n=e.presenter;return{$os:`${i()}`,isMobile:`${r()=="Mobile"}`,browser:navigator.userAgent,origin:window.location.origin,agentType:n.type==="clip"&&n.presenter_id.startsWith("v2_")?"clip_v2":n.type,agentVoice:{voiceId:(s=(t=e.presenter)==null?void 0:t.voice)==null?void 0:s.voice_id,provider:(a=(o=e.presenter)==null?void 0:o.voice)==null?void 0:a.type}}}function Ae(e,t,s){var o,a;const{event:r,...i}=e,{template:n}=(t==null?void 0:t.llm)||{},{language:d}=((o=t==null?void 0:t.presenter)==null?void 0:o.voice)||{},{stitch:v}=(t==null?void 0:t.presenter)||{};return{...i,llm:{...i.llm,template:n},script:{...i.script,provider:{...(a=i==null?void 0:i.script)==null?void 0:a.provider,language:d}},stitch:v,...s}}let R=0;function Re(e,t){var s,o,a,r,i,n,d;return e.presenter.type===j.Clip?{videoType:j.Clip,session_timeout:(s=t==null?void 0:t.streamOptions)==null?void 0:s.sessionTimeout,stream_warmup:(o=t==null?void 0:t.streamOptions)==null?void 0:o.streamWarmup,compatibility_mode:(a=t==null?void 0:t.streamOptions)==null?void 0:a.compatibilityMode}:{videoType:j.Talk,session_timeout:(r=t==null?void 0:t.streamOptions)==null?void 0:r.sessionTimeout,stream_warmup:(i=t==null?void 0:t.streamOptions)==null?void 0:i.streamWarmup,compatibility_mode:(n=t==null?void 0:t.streamOptions)==null?void 0:n.compatibilityMode,output_resolution:(d=t==null?void 0:t.streamOptions)==null?void 0:d.outputResolution}}function ge(e){return e===_.Playground?{headers:{[_e]:"true"}}:{}}async function me(e,t,s,o){try{const a=await t.newChat(e,{persist:!0},ge(o));return s.track("agent-chat",{event:"created",chat_id:a.id,agent_id:e,mode:o}),a}catch(a){try{console.error(a);const r=JSON.parse(a.message);if((r==null?void 0:r.kind)==="InsufficientCreditsError")throw new Error("InsufficientCreditsError")}catch(r){console.error("Error parsing the error message:",r)}throw new Error("Cannot create new chat")}}function xe(e,t,s,o,a){return new Promise(async(r,i)=>{var n;R=0;const d=await Le(e.id,Re(e,t),{...t,analytics:o,warmup:(n=t.streamOptions)==null?void 0:n.streamWarmup,callbacks:{...t.callbacks,onConnectionStateChange:async v=>{var f,m;v===b.Connected&&(!a&&t.mode!==_.DirectPlayback&&(a=await me(e.id,s,o,t.mode).catch(g=>{i(g)})),d?r({chat:a,streamingManager:d}):a&&i(new Error("Something went wrong while initializing the manager"))),(m=(f=t.callbacks).onConnectionStateChange)==null||m.call(f,v)},onVideoStateChange(v){var f,m;(m=(f=t.callbacks).onVideoStateChange)==null||m.call(f,v),R>0&&v===N.Start&&o.linkTrack("agent-video",{event:"start",latency:Date.now()-R},"start",[ae.StreamVideoCreated])}}}).catch(i)})}function ie(e,t){if(t&&t.length>0)return t;let s="";if(e.greetings&&e.greetings.length>0){const o=Math.floor(Math.random()*e.greetings.length);s=e.greetings[o]}else s=`Hi! I'm ${e.preview_name||"My Agent"}. How can I help you?`;return[{content:s,id:W(),role:"assistant",created_at:new Date().toISOString()}]}function Ne(e){if(e.answer!==void 0)return e.answer;let t=0,s="";for(;t in e;)s+=e[t],t++;return s}function Ve(e,t,s,o,a){if(!(e===x.Partial||e===x.Answer))return;const r=o.messages[o.messages.length-1];if((r==null?void 0:r.role)!=="assistant")return;const{content:i,sequence:n}=t;e===x.Partial?s[n]=i:s.answer=i;const d=Ne(s);(r.content!==d||e===x.Answer)&&(r.content=d,a==null||a([...o.messages],e))}async function qe(e,t){var s,o,a;let r={},i=!0;const n={messages:[],chatMode:t.mode||_.Functional},d=t.baseURL||G,v=t.wsURL||ve,f=t.mixpanelKey||fe,m=be(t.auth,d,t.callbacks.onError),g=await m.getById(e);n.messages=ie(g,t.initialMessages),(o=(s=t.callbacks).onNewMessage)==null||o.call(s,[...n.messages],"answer");const h=De({token:f,agent:g,...t});h.track("agent-sdk",{event:"loaded",...Pe(g)});const Z={onMessage:(c,u)=>{var l,w;if("content"in u)Ve(c,u,r,n,t.callbacks.onNewMessage),c===x.Answer&&h.track("agent-message-received",{messages:n.messages.length,mode:n.chatMode});else{const p=ae,M=[p.StreamVideoDone,p.StreamVideoError,p.StreamVideoRejected],$=[p.StreamFailed,p.StreamVideoError,p.StreamVideoRejected],E=Ae(u,g,{mode:n.chatMode});if(c=c,c===p.StreamVideoCreated)h.linkTrack("agent-video",E,p.StreamVideoCreated,["start"]);else if(M.includes(c)){const S=c.split("/")[1];h.track("agent-video",{...E,event:S})}$.includes(c)&&((w=(l=t.callbacks).onError)==null||w.call(l,new Error(`Stream failed with event ${c}`),{data:u})),u.event===p.StreamDone&&k()}}};async function B(c){var u,l,w,p,M,$,E;(l=(u=t.callbacks).onConnectionStateChange)==null||l.call(u,b.Connecting),R=0,c&&!i&&(delete n.chat,n.messages=ie(g),(p=(w=t.callbacks).onNewMessage)==null||p.call(w,[...n.messages],"answer"));const S=t.mode===_.DirectPlayback?Promise.resolve(void 0):Ce(t.auth,v,Z),O=xe(g,t,m,h,n.chat).catch(P=>{var H,Q;throw y(_.Maintenance),(Q=(H=t.callbacks).onConnectionStateChange)==null||Q.call(H,b.Fail),P}),[F,{streamingManager:D,chat:C}]=await Promise.all([S,O]);C&&C.id!==((M=n.chat)==null?void 0:M.id)&&((E=($=t.callbacks).onNewChat)==null||E.call($,C.id)),n.streamingManager=D,n.socketManager=F,n.chat=C,i=!1,y((C==null?void 0:C.chat_mode)??t.mode??_.Functional)}async function k(){var c,u,l,w;(c=n.socketManager)==null||c.disconnect(),await((u=n.streamingManager)==null?void 0:u.disconnect()),delete n.streamingManager,delete n.socketManager,(w=(l=t.callbacks).onConnectionStateChange)==null||w.call(l,b.Disconnected)}async function y(c){var u,l;c!==n.chatMode&&(h.track("agent-mode-change",{mode:c}),n.chatMode=c,n.chatMode!==_.Functional&&await k(),(l=(u=t.callbacks).onModeChange)==null||l.call(u,c))}return{agent:g,starterMessages:((a=g.knowledge)==null?void 0:a.starter_message)||[],changeMode:y,async connect(){var c;await B(!0),h.track("agent-chat",{event:"connect",chatId:(c=n.chat)==null?void 0:c.id,agentId:g.id,mode:n.chatMode})},async reconnect(){var c;await k(),await B(!1),h.track("agent-chat",{event:"reconnect",chatId:(c=n.chat)==null?void 0:c.id,agentId:g.id,mode:n.chatMode})},async disconnect(){var c;await k(),h.track("agent-chat",{event:"disconnect",chatId:(c=n.chat)==null?void 0:c.id,agentId:g.id,mode:n.chatMode})},async chat(c){var u,l,w,p,M,$;const E=W();r={};try{if(R=Date.now(),t.mode===_.DirectPlayback)throw new Error("Direct playback is enabled, chat is disabled");if(c.length>=800)throw new Error("Message cannot be more than 800 characters");if(c.length===0)throw new Error("Message cannot be empty");if(n.chatMode===_.Maintenance)throw new Error("Chat is in maintenance mode");if(![_.TextOnly,_.Playground].includes(n.chatMode))if(n.streamingManager){if(!n.chat)throw new Error("Chat is not initialized")}else throw new Error("Streaming manager is not initialized");n.messages.push({id:W(),role:"user",content:c,created_at:new Date(R).toISOString()}),(l=(u=t.callbacks).onNewMessage)==null||l.call(u,[...n.messages],"user"),n.chat||(n.chat=await me(g.id,m,h,n.chatMode),(p=(w=t.callbacks).onNewChat)==null||p.call(w,n.chat.id));const S={id:E,role:"assistant",content:"",created_at:new Date().toISOString(),matches:[]},O=[...n.messages];n.messages.push(S);const F=C=>{var P,H;return m.chat(g.id,C,{sessionId:(P=n.streamingManager)==null?void 0:P.sessionId,streamId:(H=n.streamingManager)==null?void 0:H.streamId,chatMode:n.chatMode,messages:O.map(({matches:Q,...we})=>we)},ge(n.chatMode))},D=await F(n.chat.id).catch(async C=>{var P;if(!((P=C==null?void 0:C.message)!=null&&P.includes("missing or invalid session_id")))throw C;return await k(),await B(!1),F(n.chat.id)});return h.track("agent-message-send",{event:"success",mode:n.chatMode,messages:n.messages.length+1}),S.context=D.context,S.matches=D.matches,D.result&&(S.content=D.result,h.track("agent-message-received",{latency:Date.now()-R,mode:n.chatMode,messages:n.messages.length}),($=(M=t.callbacks).onNewMessage)==null||$.call(M,[...n.messages],"answer")),D}catch(S){throw n.messages[n.messages.length-1].id===E&&n.messages.pop(),h.track("agent-message-send",{event:"error",mode:n.chatMode,messages:n.messages.length}),S}},rate(c,u,l){var w,p,M,$;const E=n.messages.find(O=>O.id===c);if(n.chat){if(!E)throw new Error("Message not found")}else throw new Error("Chat is not initialized");const S=((w=E.matches)==null?void 0:w.map(O=>[O.document_id,O.id]))??[];return h.track("agent-rate",{event:l?"update":"create",thumb:u===1?"up":"down",knowledge_id:((p=g.knowledge)==null?void 0:p.id)??"",mode:n.chatMode,matches:S,score:u}),l?m.updateRating(g.id,n.chat.id,l,{knowledge_id:((M=g.knowledge)==null?void 0:M.id)??"",message_id:c,matches:S,score:u}):m.createRating(g.id,n.chat.id,{knowledge_id:(($=g.knowledge)==null?void 0:$.id)??"",message_id:c,matches:S,score:u})},deleteRate(c){var u;if(!n.chat)throw new Error("Chat is not initialized");return h.track("agent-rate-delete",{type:"text",chat_id:(u=n.chat)==null?void 0:u.id,id:c,mode:n.chatMode}),m.deleteRating(g.id,n.chat.id,c)},speak(c){if(!n.streamingManager)throw new Error("Please connect to the agent first");function u(){if(typeof c=="string"){if(!g.presenter.voice)throw new Error("Presenter voice is not initialized");return{type:"text",provider:g.presenter.voice,input:c,ssml:!1}}if(c.type==="text"&&!c.provider){if(!g.presenter.voice)throw new Error("Presenter voice is not initialized");return{type:"text",provider:g.presenter.voice,input:c.input,ssml:c.ssml}}return c}const l=u();return h.track("agent-speak",l),n.streamingManager.speak({script:l})}}}let Be="agt_2Ln7eSse",he={type:"key",clientKey:"Z29vZ2xlLW9hdXRoMnwxMDY2MDg2Mjg1ODMyNzI0ODg1NjY6VVhuNVJCVXFtMlkxQXppTnZtSGk4"},A=document.querySelector("#videoElement"),V=document.querySelector("#textArea"),te=document.querySelector("#langSelect"),z=document.querySelector("#speechButton"),K=document.querySelector("#answers"),L=document.querySelector("#connectionLabel"),U=document.querySelector("#chatButton"),J=document.querySelector("#speakButton"),He=document.querySelector("#reconnectButton"),ne=document.querySelector("#sendButton"),ee;const je={onSrcObjectReady(e){return console.log("onSrcObjectReady():",e),A.srcObject=e,ee=e,ee},onConnectionStateChange(e){console.log("onConnectionStateChange(): ",e),e=="connecting"?(L.innerHTML="Connecting..",document.querySelector("#container").style.display="flex",document.querySelector("#hidden").style.display="none"):e=="connected"?(V.addEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),X())}),U.removeAttribute("disabled"),J.removeAttribute("disabled"),te.removeAttribute("disabled"),z.removeAttribute("disabled"),ne.removeAttribute("disabled"),L.innerHTML="Online"):(e=="disconnected"||e=="closed")&&(V.removeEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),X())}),document.querySelector("#hidden_h2").innerHTML=`${T.agent.preview_name} Disconnected`,document.querySelector("#hidden").style.display="block",document.querySelector("#container").style.display="none",U.setAttribute("disabled",!0),J.setAttribute("disabled",!0),te.setAttribute("disabled",!0),z.setAttribute("disabled",!0),ne.setAttribute("disabled",!0),L.innerHTML="")},onVideoStateChange(e){console.log("onVideoStateChange(): ",e),e=="STOP"?(A.muted=!0,A.srcObject=void 0,A.src=T.agent.presenter.idle_video):(A.muted=!1,A.src="",A.srcObject=ee,L.innerHTML="Online")},onNewMessage(e,t){console.log("onNewMessage():",e,t);let s=e.length-1,o=e[s];o.role=="assistant"&&e.length!=1?t=="answer"&&(K.innerHTML+=`${ce()} - [${o.role}] : ${o.content}  <button id='${o.id}_plus' title='agentManager.rate() -> Rate this answer (+)'>+</button> <button id='${o.id}_minus' title='agentManager.rate() -> Rate this answer (-)'>-</button> <br>`,document.getElementById(`${o.id}_plus`).addEventListener("click",()=>se(o.id,1)),document.getElementById(`${o.id}_minus`).addEventListener("click",()=>se(o.id,-1))):K.innerHTML+=`${ce()} - [${o.role}] : ${o.content}  <br>`,K.scrollTop=K.scrollHeight},onError(e,t){L.innerHTML='<span style="color:red">Something went wrong :(</span>',console.log("Error:",e,"Error Data",t)}};let Fe={compatibilityMode:"auto",streamWarmup:!0,outputResolution:1080};function Ke(){let e=V.value;e!==""&&e.length>2&&(T.speak({type:"text",input:e}),console.log(`agentManager.speak("${e}")`),L.innerHTML="Streaming..")}function X(){let e=V.value;e!==""&&(T.chat(e),console.log("agentManager.chat()"),L.innerHTML="Thinking..",V.value="")}function se(e,t){let s=T.rate(e,t);console.log(`Message ID: ${e} Rated:${t}
`,"Result",s)}function We(){console.log("clicked");let e=T.reconnect();console.log("agentManager.reconnect()",e)}function ce(){const e=new Date,t=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),o=e.getSeconds().toString().padStart(2,"0");return`${t}:${s}:${o}`}he.clientKey==""&&(L.innerHTML="<span style='color:red; font-weight:bold'> Missing agentID and auth.clientKey variables</span>",console.error("Missing agentID and auth.clientKey variables"),console.log(`Missing agentID and auth.clientKey variables:

Fetch the data-client-key and the data-agent-id as explained on the Agents SDK Overview Page:
https://docs.d-id.com/reference/agents-sdk-overview

Paste these into their respective variables at the top of the main.js file and save.`));U.addEventListener("click",()=>X());J.addEventListener("click",()=>Ke());He.addEventListener("click",()=>We());z.addEventListener("click",()=>toggleStartStop());ne.addEventListener("click",()=>X());window.addEventListener("load",()=>{V.focus(),U.setAttribute("disabled",!0),J.setAttribute("disabled",!0),te.setAttribute("disabled",!0),z.setAttribute("disabled",!0)});let T=await qe(Be,{auth:he,callbacks:je,streamOptions:Fe});console.log("sdk.createAgentManager()",T);document.querySelector("#previewName").innerHTML=T.agent.preview_name;console.log("agentManager.connect()");T.connect();var q;navigator.userAgent.includes("Firefox")?q=new SpeechRecognition:q=new webkitSpeechRecognition;q.lang=langSelect.value;q.continuous=!0;pe();q.onend=pe;q.onresult=function(e){console.log(e);for(var t=e.resultIndex;t<e.results.length;++t)e.results[t].isFinal&&(console.log(".."),textArea.value+=e.results[t][0].transcript)};function pe(){speechButton.style.color="",speechButton.innerHTML='<span class="material-symbols-outlined">mic</span>',chatButton.removeAttribute("disabled"),speakButton.removeAttribute("disabled")}
